@{
    ViewBag.Title = "userholds";
}
<div class="account-container">
    <div class="account-controls-panel">
        <div class="library-logo">
            Library Logo
        </div>
        <div class="user-info">
            <div class="user-pfp-container">
                <img src="~/images/pfp_male.svg" id="user-pfp-img" />
            </div>
            <h1 class="display-1">@(TempData.Peek("fullName"))</h1>
        </div>
        <a class="account-nav active-l" asp-area="" asp-controller="Home" asp-action="UserDashboard">
            <i class="fa-solid fa-chart-bar"></i>
            <h2 class="display-2">Dashboard</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Student" asp-action="StudentCheckouts">
            <i class="fa-solid fa-list-check"></i>
            <h2 class="display-2">My Checkouts</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Hold" asp-action="userHolds">
            <i class="fa-solid fa-list-check"></i>
            <h2 class="display-2">My Holds</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Review" asp-action="CreateReview">
            <i class="fa-solid fa-star-half-stroke"></i>
            <h2 class="display-2">Create a review</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Student" asp-action="StudentBalance">
            <i class="fa-solid fa-money-bill"></i>
            <h2 class="display-2">Balance</h2>
        </a>
        <a class="account-nav" asp-controller="DashboardSettings" asp-action="Student" asp-route-id="@TempData.Peek("libraryCard")">
            <i class="fa-solid fa-gear"></i>
            <h2 class="display-2">Settings</h2>
        </a>
        <a class="account-nav" id="account-signout-btn" asp-controller="Account" asp-action="Logout">
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
            <h2 class="display-2">Sign out</h2>
        </a>
        @if ((string)TempData.Peek("role") == "manager" || (string)TempData.Peek("role")=="employee")
        {
             <a class="account-nav" asp-area="" asp-controller="Hold" asp-action="allHolds">
                <i class="fa-solid fa-list-check"></i>
                <h2 class="display-2">All Holds</h2>
            </a>
        }
    </div>
    <div class="user-combined-panel" style="width: 100%;">
        <div class="user-entry-container">
        </div>
        <div class="user-recent-transactions-panel" style="height: 100%">
            <div class="user-recent-transactions">
                <div class="recent-transactions-header">
                    <h1 class="display-1" style="text-align: center">Current Holds</h1>
                    <h2 class="display-2" id="recent-transactions-subheader"></h2>
                </div>
                <div class="table-container" style="display:none">
                    <table id="transactions-table" class="display cell-border" style="width:100%">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Title</th>
                                <th>Media ID</th>
                                <th>Hold Date</th>
                                <th>checkout Item</th>
                            </tr>
                        </thead>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        table = $('#transactions-table').DataTable({
            "ajax": {
                "type": "GET",
                "data": { "userid": "@(TempData.Peek("libraryCard"))", "role": "@TempData.Peek("role")"},
                "url": "/Hold/GetUserHoldList",
                "dataSrc": ''
            },
            "columns":
                [
                    { "data": "userid" },
                    { "data": "title" },
                    { "data": "mediaid" },
                    { "data": "date" },
                    {
                        "data":null,
                        "render": function(data, type, full, meta) {
                            if (data.available) {
                                 return "<a style='cursor:pointer' class='return-item'><i class='fa-regular fa-square'></i></a>";
                            } else {
                                return "<a style='cursor:pointer' class='return-item'><i class='fa-regular fa-square'></i></a>";
                            }
                           
                        }
                    }
                ],
            "createdRow": function (row, data, dataIndex) {
                $(row).addClass('light-green');

            }
        });
        $('.table-container').show();
    });
    $('#transactions-table').on('click', '.return-item', function () {
        let tr = $(this).closest('tr');
        let mediaId = table.row(tr).data().mediaId;

        window.location.href = '/Checkout/CheckoutItem?mediaId=' + mediaId;
    })
</script>