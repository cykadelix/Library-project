@using Library_project.Data.Enums
@model Library_project.ViewModels.Reports.checkoutsByStudentReportViewModel
@{
    ViewBag.Title = "CheckoutsByUserIndex";
}

<div class="account-container">
    <div class="account-controls-panel">
        <div class="library-logo">
            Library Logo
        </div>
        <div class="user-info">
            <div class="user-pfp-container">
                <img src="~/images/pfp_male.svg" id="user-pfp-img" />
            </div>
            <h1 class="display-1">@(TempData.Peek("fullName"))</h1>
        </div>
        <a class="account-nav" asp-area="" asp-controller="Home" asp-action="AdminDashboard">
            <i class="fa-solid fa-chart-bar"></i>
            <h2 class="display-2">Dashboard</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="AddMedia" asp-action="AddComputer">
            <i class="fa-solid fa-boxes-stacked"></i>
            <h2 class="display-2">Inventory</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Employee" asp-action="EmployeeIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Employees</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Historian" asp-action="HistorianIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Historians</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Student" asp-action="StudentIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Students</h2>
        </a>
        <a class="account-nav active-l" asp-area="" asp-controller="Reports" asp-action="CheckoutsByDateIndex">
            <i class="fa-solid fa-boxes-stacked"></i>
            <h2 class="display-2">Report Generator</h2>
        </a>
        <a class="account-nav" asp-controller="DashboardSettings" asp-action="Admin" asp-route-id="@(TempData.Peek("libraryCard"))">
            <i class="fa-solid fa-gear"></i>
            <h2 class="display-2">Settings</h2>
        </a>
        <a class="account-nav" id="account-signout-btn">
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
            <h2 class="display-2">Sign out</h2>
        </a>
    </div>
    <div class="report-container">
        <div class="media-form-header">
            <h1 class="display-1">Choose a report type:</h1>
            <select name="report-type" id="report-type">
                <option>Checkouts</option>
                <option>Ratings</option>
                <option selected="true">Student Checkouts</option>
                <option>Overdue Fees</option>
            </select>

            <h1 class="display-1">Checkouts by Student</h1>
            <form class="report-form">
                <div class="input-wrapper-horizontal">
                    <label asp-for="library_card_number">Library Card Number:</label>
                    <input type="number" name="library_card_number" id="librarycardnumber-input" placeholder="ID of item">
                    <span asp-validation-for="library_card_number" class="text-danger"></span>
                </div>
                <button type="submit">Generate Report</button>
            </form>
        </div>
        <div class="table-container" style="display:none">
            <table id="transactions-table" class="display cell-border" style="width:100%">
                <thead>
                    <tr>
                        <th>Library Card Number</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Type</th>
                        <th>Item</th>
                        <th>Checkout Date</th>
                        <th>Return Date</th>
                        <th>Return Status</th>
                        <th>Return Item</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

<script>
    let checkoutList;
    let table;
    //Get list of Audiobooks
    $(document).ready(function () {
        $('#transactions-table').DataTable({
            "destroy": true,
        });
        //Creating datatable
        $("form").submit(function (e) {
            e.preventDefault();
            var formData = {
                libraryCardNumber: $('#librarycardnumber-input').val(),
                fname: null,
                lname: null,
                mediaType: null,
                item: null,
                checkoutDate: null,
                returnDate: null,
                returnStatus: null,
                returnItem: null,
                };
            table = $('#transactions-table').DataTable({
                "destroy": true,
                "ajax": {
                    "type": "GET",
                    "data": formData,
                    "url": '/Reports/GetCheckoutsByStudentList',
                    "dataSrc": ''
                },
                "columns": [
                    { "data": "libraryCardNumber" },//1
                    { "data": "fname" },//2
                    { "data": "lname" },//3
                    { "data": "mediaType" },//4
                    { "data": "item" },//5
                    { "data": "checkoutDate" },//6
                    { "data": "returnDate" },//7
                    { "data": "returnStatus" },//8
                    { "data": "returnItem" }//9

                ],
            });
        });
    });</script>


<!----
<script>
    let checkoutList;
    let table;
    //Get list of checkouts by a specific student
    $(document).ready(function () {
        if ($.fn.DataTable.isDataTable('#transactions-table'))
        {
            $('#transactions-table').DataTable().destroy();
        }
        //Creating data for datatable
        $("form").submit(function (e) {
            e.preventDefault();
            var formData = {
                libraryCardNumber: $('#librarycardnumber-input').val(),
                fname: null,
                lname: null,
                mediaType: null,
                item: null,
                checkoutDate: null,
                returnDate: null,
                averageRating: null,
                returnStatus: null,
                returnItem: null,
            };
            //Creating datatable
            table = $('#transactions-table').DataTable({
                "destroy": true,
                "ajax": {
                    "type": "GET",
                    "data": formData,
                    "url": '/Report/GetCheckoutsByStudentList',
                    "dataSrc": ''
                },
                "columns": [
                    { "data": "libraryCardNumber" },//1
                    { "data": "fname" },//2
                    { "data": "lname" },//3
                    { "data": "mediaType" },//4
                    {
                        "data": null,
                        "render": function (data, type, full, meta) {
                            if (data.brand == "") {
                                return data.title;
                            } else {
                                return (data.brand + " " + data.serialNo);
                            }
                        }
                    },//5
                    { "data": "checkoutDate" },//6
                    { "data": "returnDate" },//7
                    {
                        "data": null,
                        "render": function (data, type, full, meta) {
                            if (data.returned == true) {
                                return data.returnedDate;
                            } else {
                                return "N/A";
                            }
                        }
                    },//8
                    {
                        "data": null,
                        "render": function (data, type, full, meta) {
                            if (data.returned) {
                                return "<i class='fa-regular fa-square-check'></i>";
                            } else {
                                return "<a style='cursor:pointer' class='return-item'><i class='fa-regular fa-square'></i></a>";
                            }
                        }
                    }//9
                ],
                "createdRow": function (row, data, dataIndex) {
                    if (data['returned'] == true) {
                        $(row).addClass('light-green');
                    } else if (Date.now() - Date.parse(data.returnDate) > 0) {
                        $(row).addClass('light-red');
                    } else {
                        $(row).addClass('light-orange');
                    }
                }
            });
            $('.table-container').show();
        });
        //Return
        $('#transactions-table').on('click', '.return-item', function () {
            let tr = $(this).closest('tr');
            let mediaId = table.row(tr).data().mediaId;

            window.location.href = '/Checkout/Checkoutitem?mediaId=' + mediaId;
        });
        //Cancel
        $('.user-entry-form').on('click', '.media-cancel-btn', function () {
            window.location.href = "/Reports/CheckoutsByStudentIndex";
        });
    });
</script>
    -->
