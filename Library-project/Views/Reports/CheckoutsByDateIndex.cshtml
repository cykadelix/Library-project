@using Library_project.Data.Enums
@model Library_project.ViewModels.Reports.checkoutReportViewModel
@{
    ViewBag.Title = "CheckoutsByDateIndex";
}

<div class="account-container">
    <div class="account-controls-panel">
        <div class="library-logo">
            Library Logo
        </div>
        <div class="user-info">
            <div class="user-pfp-container">
                <img src="~/images/pfp_male.svg" id="user-pfp-img" />
            </div>
            <h1 class="display-1">Name</h1>
        </div>
        <a class="account-nav" asp-area="" asp-controller="Home" asp-action="AdminDashboard">
            <i class="fa-solid fa-chart-bar"></i>
            <h2 class="display-2">Dashboard</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="AddMedia" asp-action="AddComputer">
            <i class="fa-solid fa-boxes-stacked"></i>
            <h2 class="display-2">Inventory</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Employee" asp-action="EmployeeIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Employees</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Historian" asp-action="HistorianIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Historians</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Student" asp-action="StudentIndex">
            <i class="fa-solid fa-user-group"></i>
            <h2 class="display-2">Manage Students</h2>
        </a>
        <a class="account-nav" asp-area="" asp-controller="Reports" asp-action="CheckoutsByDateIndex">
            <i class="fa-solid fa-boxes-stacked"></i>
            <h2 class="display-2">Report Generator</h2>
        </a>
        <a class="account-nav">
            <i class="fa-solid fa-gear"></i>
            <h2 class="display-2">Settings</h2>
        </a>
        <a class="account-nav" id="account-signout-btn">
            <i class="fa-solid fa-arrow-right-from-bracket"></i>
            <h2 class="display-2">Sign out</h2>
        </a>
    </div>
    <div class="media-entry-container">
        <div class="media-form-header">
            <h1 class="display-1">Choose a report type:</h1>
            <select name="report-type" id="report-type">
                <option selected="true">Checkouts</option>
                <option>Ratings</option>
                <option>Students</option>
                <option>Overdue Fees</option>
            </select>
        </div>
    </div>
    <div class="user-combined-panel">
        <div class="user-entry-container">
            <div class="media-form-header">
                <h1 class="display-1">Checkouts within TimeFrame</h1>
            </div>
            <form class="user-entry-form" asp-action="GetCheckoutsByDateList" asp-controller="Reports" method="post">
                <div class="input-wrapper-horizontal">
                    <label asp-for="q_startDate">Start Date:</label>
                    <input type="date" name="q_startDate" placeholder="YYYY-MM-DD">
                    <span asp-validation-for="q_startDate" class="text-danger"></span>
                </div>
                <div class="input-wrapper-horizontal">
                    <label asp-for="q_endDate">End Date:</label>
                    <input type="date" name="q_endDate" placeholder="YYYY-MM-DD">
                    <span asp-validation-for="q_endDate" class="text-danger"></span>
                </div>
                <button type="submit">Generate Report</button>
            </form>
        </div>
    <div class="table-container" style="display:none">
        <table id="transactions-table" class="display cell-border" style="width:100%">
            <thead>
                <tr>
                    <th>CheckoutID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Checkout Date</th>
                    <th>Return Date</th>
                    <th>Return Status</th>
                </tr>
            </thead>
        </table>
    </div>
    <script></script>
</div>

<script>
    let mediaList;
    let table;
    //Get list of Audiobooks
    $(document).ready(function () {
        //Creating datatable
        $("#getCheckoutReport").on('submit', (function () {
            table = $('#transactions-table').DataTable({
                "ajax": {
                    "type": "GET",
                    "data": $(this).serialize(),
                    "url": '/Reports/GetCheckoutsByDateList',
                    "dataSrc": ''
                },
                "columns": [
                    { "data": "checkoutid" },
                    { "data": "studentfname" },
                    { "data": "studentlname" },
                    { "data": "checkoutdate" },
                    { "data": "returndate" },
                    { "data": "returnstatus" },
                ],
                "bLengthChange": false,
                "pageLength": 5
            });
        }))
        $('.table-container').show();
    });
    //Edit button
    $('#transactions-table').on('click', '.edit-row-btn', function () {
        let tr = $(this).closest('tr');
        let audiobookId = table.row(tr).data().audiobookid;

        window.location.href = "/AddMedia/EditAudiobookForm?audiobookId=" + audiobookId;
    });
    //Delete
    $('#transactions-table').on('click', '.delete-row-btn', function () {
        let tr = $(this).closest('tr');
        let audiobookId = table.row(tr).data().audiobookid;

        $.ajax({
            type: 'DELETE',
            url: '/AddMedia/DeleteAudiobook?audiobookId=' + audiobookId,
            async: false,
            success: function (result) {
                window.location.href = result.redirectToUrl;
            },
        });
    });
    //Cancel
    $('.media-entry-form').on('click', '.media-cancel-btn', function () {
        window.location.href = "/AddMedia/AddAudiobook";
    });

    $("#media-type").val("Audiobook");
    $('#audiobook-availability').on('change', function () {
        this.value = this.checked ? val(true) : val(false);
    });
</script>
